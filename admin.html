<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Admin - Diccionario AR</title>
  <style>
    @font-face {
      font-family: 'MiddleOfApril';
      src: url('Middle-of-April.ttf') format('truetype');
    }
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', sans-serif;
      background:
        linear-gradient(to bottom, rgba(0,0,0,0.85), rgba(0,0,0,0.95)),
        url('FONDOOO.jpeg') no-repeat center center fixed;
      background-size: cover;
      background-attachment: fixed;
      color: #f1f1f1;
    }
    h1 {
      font-family: 'MiddleOfApril', cursive;
      font-size: 3rem;
      color: #3ae374;
      text-align: center;
      margin-bottom: 30px;
    }
    .contenedor, .login {
      max-width: 1000px;
      margin: 0 auto;
      background-color: #1e1e1e;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    #buscador, .login input {
      margin-bottom: 20px;
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background-color: #2a2a2a;
      color: white;
      font-size: 16px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #444;
      text-align: left;
    }
    th {
      background-color: #007acc;
      color: white;
      cursor: pointer;
    }
    td {
      background-color: #2a2a2a;
    }
    button {
      background-color: #444;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 20px;
    }
    button:hover {
      background-color: #3ae374;
      color: black;
    }
    #adminPanel { display: none; }
      .azul { color: #1877f2; }
    .rojo { color: #ff5c39; }
    tr:nth-child(even) td { background-color: #242424; }
    button { padding: 8px 16px; font-size: 14px; }
    input:focus { outline: 2px solid #3ae374; }
  </style>
</head>
<body onload="document.getElementById('clave').focus()">
  <h1><span class="azul">PANEL</span> <span class="rojo">ADMIN</span></h1>
  <div class="login" id="loginPanel">
    <form onsubmit="verificarClave(); return false;">
      <input type="password" id="clave" placeholder="Ingrese la contrase√±a">
      <button type="submit">Ingresar</button>
      <button type="button" onclick="window.location.href='index.html'" style="margin-top: 10px; background-color: #777;">Volver al inicio</button>
    </form>
  </div>
  <div class="contenedor" id="adminPanel">
    <input type="text" id="buscador" placeholder="Buscar por t√©rmino..." onkeyup="filtrarTabla()">
    <table id="tablaTerminos">
      <thead>
        <tr>
          <th onclick="ordenarTabla(0)">T√©rmino</th>
          <th onclick="ordenarTabla(1)">Traducci√≥n</th>
          <th onclick="ordenarTabla(2)">Pronunciaci√≥n</th>
          <th onclick="ordenarTabla(3)">Categor√≠a</th>
          <th onclick="ordenarTabla(4)">Definici√≥n</th>
          <th onclick="ordenarTabla(5)">Sin√≥nimos</th>
          <th onclick="ordenarTabla(6)">Tipo</th>
          <th onclick="ordenarTabla(7)">Forma farmac√©utica</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr><td colspan="9" style="text-align:center;">Cargando t√©rminos...</td></tr>
      </tbody>
    </table>
    <button onclick="window.location.href='index.html'">Volver al inicio</button>
  </div>
  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbzAzMs8JEWCQM0fzZobajM3iozSpTVnyS8mDtJuccWVmeu-rg4M3ed41fXWXEEBpz8/exec';

    function verificarClave() {
      const clave = document.getElementById("clave").value;
      if (clave === "ARdic@2025") {
        document.getElementById("loginPanel").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";
        cargarDatos();
      } else {
        alert("Contrase√±a incorrecta");
        document.getElementById("clave").value = "";
      }
    }

    function cargarDatos() {
      fetch(API_URL)
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector("#tablaTerminos tbody");
          tbody.innerHTML = "";

          for (const termino in data) {
            const fila = data[termino];
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${termino}</td>
              <td>${fila["Traducci√≥n"] || ""}</td>
              <td>${fila["Pronunciaci√≥n"] || ""}</td>
              <td>${fila["Categor√≠a"] || ""}</td>
              <td>${fila["Definici√≥n"] || ""}</td>
              <td>${fila["Sin√≥nimos"] || ""}</td>
              <td>${fila["Tipo de t√©rmino"] || ""}</td>
              <td>${fila["Forma farmac√©utica"] || ""}</td>`;
            const editarBtn = `<button onclick=\"editarFila(this)\">‚úèÔ∏è</button>`;
            const eliminarBtn = `<button onclick=\"eliminarFila(this)\">üóëÔ∏è</button>`;
            const acciones = `<td>${editarBtn} ${eliminarBtn}</td>`;
            tr.innerHTML += acciones;
            tbody.appendChild(tr);
          }
        })
        .catch(err => {
          const tbody = document.querySelector("#tablaTerminos tbody");
          tbody.innerHTML = `<tr><td colspan="9">‚ùå Error al cargar los t√©rminos.</td></tr>`;
          console.error("Error cargando t√©rminos:", err);
        });
    }

    function filtrarTabla() {
      const input = document.getElementById("buscador").value.toLowerCase();
      const filas = document.querySelectorAll("#tablaTerminos tbody tr");
      filas.forEach(fila => {
        const termino = fila.cells[0]?.innerText.toLowerCase() || "";
        fila.style.display = termino.includes(input) ? "" : "none";
      });
    }

    function ordenarTabla(columna) {
      const tabla = document.getElementById("tablaTerminos");
      let filas = Array.from(tabla.rows).slice(1);
      let ordenAsc = tabla.getAttribute("data-orden") !== "asc";
      tabla.setAttribute("data-orden", ordenAsc ? "asc" : "desc");

      filas.sort((a, b) => {
        const textoA = a.cells[columna].innerText.toLowerCase();
        const textoB = b.cells[columna].innerText.toLowerCase();
        return ordenAsc ? textoA.localeCompare(textoB) : textoB.localeCompare(textoA);
      });

      const tbody = tabla.querySelector("tbody");
      tbody.innerHTML = "";
      filas.forEach(f => tbody.appendChild(f));
    }

    function editarFila(boton) {
      const fila = boton.parentNode.parentNode;
      const celdas = fila.querySelectorAll("td");
      for (let i = 0; i < celdas.length - 1; i++) {
        const texto = celdas[i].innerText;
        celdas[i].innerHTML = `<input value="${texto}" style='width: 100%; background-color: #2a2a2a; color: white; border: none; padding: 4px;'>`;
      }
      boton.textContent = 'üíæ';
      boton.onclick = () => guardarEdicion(fila);
    }

    function guardarEdicion(fila) {
      const inputs = fila.querySelectorAll("input");
      const valores = Array.from(inputs).map(input => input.value.trim());
      const terminoClave = valores[0];

      valores.forEach((valor, i) => {
        fila.cells[i].innerText = valor;
      });

      fila.querySelector("button").textContent = '‚úèÔ∏è';
      fila.querySelector("button").onclick = () => editarFila(fila.querySelector("button"));

      fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          actualizar: true,
          termino: terminoClave,
          traduccion: valores[1],
          pronunciacion: valores[2],
          categoria: valores[3],
          definicion: valores[4],
          sinonimos: valores[5],
          tipo: valores[6],
          formaFarmaceutica: valores[7]
        })
      })
      .then(res => res.text())
      .then(msg => {
        console.log('‚úÖ Actualizado en Google Sheets:', msg);
        const popup = document.getElementById("popupMsg");
        popup.textContent = msg;
        popup.style.display = "block";
        setTimeout(() => popup.style.display = "none", 2000);
      })
      .catch(err => console.error('‚ùå Error al actualizar en Sheets:', err));
    }

    function eliminarFila(boton) {
      const fila = boton.parentNode.parentNode;
      const termino = fila.cells[0]?.innerText;
      if (confirm("¬øSeguro que deseas eliminar esta fila?")) {
        fila.remove();
        fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ eliminar: true, termino })
        })
        .then(res => res.text())
        .then(msg => console.log('üóëÔ∏è Eliminado en Google Sheets:', msg))
        .catch(err => console.error('‚ùå Error al eliminar en Sheets:', err));
      }
    }
  </script>
  <div id="popupMsg" style="display:none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background-color: #3ae374; color: black; padding: 12px 24px; border-radius: 10px; font-weight: bold; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.5);">‚úÖ T√©rmino actualizado</div>
</body>
</html>
